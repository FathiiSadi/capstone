version: 1
frontend:
  phases:
    install:
      runtime-versions:
        php: 8.3
    preBuild:
      commands:
        - sudo yum install -y php-cli php-common php-mysqlnd php-pdo php-xml php-mbstring php-gd php-zip php-intl php-bcmath wget unzip
        - php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
        - php composer-setup.php
        - php -r "unlink('composer-setup.php');"
        - php composer.phar install --no-dev --optimize-autoloader
        - npm install
    build:
      commands:
        - npm run build
        - php artisan migrate --force
        - php artisan db:seed --force
        - php artisan filament:upgrade
        - php artisan config:cache
        - php artisan route:cache
  artifacts:
    baseDirectory: public
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - vendor/**/*
