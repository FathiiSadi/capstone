# AWS Quick Start Guide

This is a condensed version of the full deployment guide. Use this for quick reference.

## Prerequisites Checklist

- [ ] AWS Account created
- [ ] AWS RDS MySQL instance created and endpoint noted
- [ ] EC2 instance launched (Ubuntu 22.04 or Amazon Linux 2023)
- [ ] Domain name pointed to EC2 IP (optional)
- [ ] SSH access to EC2 instance

## Quick Deployment Steps

### 1. Connect to EC2

```bash
ssh -i your-key.pem ubuntu@your-ec2-ip
```

### 2. Install Required Software (Ubuntu)

```bash
sudo apt update && sudo apt upgrade -y
sudo add-apt-repository ppa:ondrej/php -y
sudo apt update
sudo apt install -y php8.2 php8.2-cli php8.2-fpm php8.2-mysql php8.2-xml \
    php8.2-mbstring php8.2-curl php8.2-zip php8.2-gd php8.2-bcmath \
    php8.2-intl php8.2-readline nginx composer nodejs npm git

# Install Composer if not included
curl -sS https://getcomposer.org/installer | php
sudo mv composer.phar /usr/local/bin/composer
```

### 3. Deploy Application

```bash
cd /var/www
sudo git clone https://github.com/your-username/capstone.git
# or upload via SCP/SFTP
sudo chown -R $USER:$USER /var/www/capstone
cd capstone
cp .env.example .env
nano .env  # Configure with your RDS credentials
chmod +x deploy-aws.sh
./deploy-aws.sh
```

### 4. Configure Nginx

```bash
sudo nano /etc/nginx/sites-available/capstone
```

Paste configuration (see DEPLOYMENT.md for full config), then:

```bash
sudo ln -s /etc/nginx/sites-available/capstone /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

### 5. Set Permissions

```bash
sudo chown -R www-data:www-data /var/www/capstone
sudo chmod -R 755 /var/www/capstone
sudo chmod -R 775 storage bootstrap/cache
```

### 6. Setup Queue Worker (Supervisor)

```bash
sudo apt install -y supervisor
sudo nano /etc/supervisor/conf.d/capstone-worker.conf
```

Add:
```ini
[program:capstone-worker]
command=php /var/www/capstone/artisan queue:work --sleep=3 --tries=3
autostart=true
autorestart=true
user=www-data
numprocs=1
redirect_stderr=true
stdout_logfile=/var/www/capstone/storage/logs/worker.log
```

Then:
```bash
sudo supervisorctl reread
sudo supervisorctl update
sudo supervisorctl start capstone-worker:*
```

### 7. Setup Scheduler (Cron)

```bash
sudo crontab -e -u www-data
```

Add:
```
* * * * * cd /var/www/capstone && php artisan schedule:run >> /dev/null 2>&1
```

### 8. Setup SSL (Let's Encrypt)

```bash
sudo apt install -y certbot python3-certbot-nginx
sudo certbot --nginx -d your-domain.com -d www.your-domain.com
```

## Environment Variables (.env)

Key variables to configure:

```env
APP_ENV=production
APP_DEBUG=false
APP_URL=https://your-domain.com
APP_KEY=base64:...  # Generated by deploy script

DB_CONNECTION=mysql
DB_HOST=your-rds-endpoint.rds.amazonaws.com
DB_PORT=3306
DB_DATABASE=capstone
DB_USERNAME=your_username
DB_PASSWORD=your_password

LOG_CHANNEL=daily
LOG_LEVEL=error
SESSION_ENCRYPT=true
```

## Common Commands

```bash
# View logs
tail -f /var/www/capstone/storage/logs/laravel.log

# Clear caches
cd /var/www/capstone
php artisan cache:clear
php artisan config:clear
php artisan route:clear
php artisan view:clear

# Restart queue worker
sudo supervisorctl restart capstone-worker:*

# Check queue worker status
sudo supervisorctl status

# Update application
cd /var/www/capstone
git pull
composer install --no-dev --optimize-autoloader
npm ci --production && npm run build
php artisan migrate --force
php artisan config:cache
php artisan route:cache
php artisan view:cache
sudo supervisorctl restart capstone-worker:*
```

## Troubleshooting

### 500 Error
- Check logs: `tail -f storage/logs/laravel.log`
- Verify `.env` file exists and is configured
- Check permissions: `sudo chown -R www-data:www-data /var/www/capstone`

### Database Connection Failed
- Verify RDS security group allows EC2 IP
- Check `.env` has correct RDS endpoint
- Test: `php artisan db:show`

### Queue Not Working
- Check supervisor: `sudo supervisorctl status`
- Restart: `sudo supervisorctl restart capstone-worker:*`
- Check logs: `tail -f storage/logs/worker.log`

## Security Checklist

- [ ] `APP_DEBUG=false`
- [ ] Strong `APP_KEY` generated
- [ ] `SESSION_ENCRYPT=true`
- [ ] SSL certificate installed
- [ ] RDS security group configured
- [ ] Firewall allows only ports 80, 443, 22
- [ ] Regular backups configured

---

For detailed instructions, see [DEPLOYMENT.md](./DEPLOYMENT.md)
